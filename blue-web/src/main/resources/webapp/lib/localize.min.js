'use strict';angular.module('localization',[]).provider('localize',function localizeProvider(){this.languages=['en','fr'];this.defaultLanguage='en';this.ext='js';var n=this;this.$get=['$http','$rootScope','$window','$filter',function(h,i,j,k){var l={language:'',dictionary:[],url:undefined,resourceFileLoaded:false,successCallback:function(a){l.dictionary=a;l.resourceFileLoaded=true;i.$broadcast('localizeResourcesUpdated')},setLanguage:function(a){l.language=this.fallbackLanguage(a);l.initLocalizedResources()},fallbackLanguage:function(a){a=String(a);if(n.languages.indexOf(a)>-1){return a}a=a.split('-')[0];if(n.languages.indexOf(a)>-1){return a}return n.defaultLanguage},setUrl:function(a){l.url=a;l.initLocalizedResources()},buildUrl:function(){if(!l.language){var a,androidLang;if(j.navigator&&j.navigator.userAgent&&(androidLang=j.navigator.userAgent.match(/android.*\W(\w\w)-(\w\w)\W/i))){a=androidLang[1]}else{a=j.navigator.userLanguage||j.navigator.language}l.language=this.fallbackLanguage(a)}return'i18n/resources-locale_'+l.language+'.'+n.ext},initLocalizedResources:function(){var b=l.url||l.buildUrl();return h({method:"GET",url:b,cache:false}).success(l.successCallback).error(function(){var a='i18n/resources-locale_default'+'.'+n.ext;h({method:"GET",url:a,cache:false}).success(l.successCallback)})},getLocalizedString:function(b){var c=arguments;var d='';if((l.dictionary!==[])&&(l.dictionary.length>0)){var f=k('filter')(l.dictionary,function(a){return a.key===b});var g=0;d=f[0]?f[0].value.replace(/\\s/g,function(e){return c[++g]}):b.replace(/_/g,' ').trim()}else{d=b.replace(/_/g,' ').trim()}return d}};var m=l.initLocalizedResources();return l}]}).filter('i18n',['localize',function(b){return function(a){return b.getLocalizedString(a)}}]).directive('i18n',['localize',function(g){var h={restrict:"EAC",updateText:function(a,b){var c=b.split('|');if(c.length>=1){var d=g.getLocalizedString(c[0]);if((d!==null)&&(d!==undefined)&&(d!=='')){if(c.length>1){for(var e=1;e<c.length;e++){var f='{'+(e-1)+'}';d=d.replace(f,c[e])}}a.text(d)}}},link:function(b,c,d){b.$on('localizeResourcesUpdated',function(){h.updateText(c,d.i18n)});d.$observe('i18n',function(a){h.updateText(c,d.i18n)})}};return h}]).directive('i18nAttr',['localize',function(g){var h={restrict:"EAC",updateText:function(a,b){var c=b.split('|');var d=g.getLocalizedString(c[0]);if((d!==null)&&(d!==undefined)&&(d!=='')){if(c.length>2){for(var e=2;e<c.length;e++){var f='{'+(e-2)+'}';d=d.replace(f,c[e])}}a.attr(c[1],d)}},link:function(b,c,d){b.$on('localizeResourcesUpdated',function(){h.updateText(c,d.i18nAttr)});d.$observe('i18nAttr',function(a){h.updateText(c,a)})}};return h}]);